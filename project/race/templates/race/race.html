{% extends 'base.html' %}
{% load static %}
<head>
    <!-- style sheets-->
    <link rel="stylesheet" href="{% static 'race/race_styles.css' %}">
    <!-- Leaflet mapping plugin-->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <!-- Font Awesome for map race icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <!--scripts-->
    <script>
        const loggedInUser = "{{ request.user }}";  
        const raceID="{{ race.id }}";
    </script>
    {% csrf_token %}
    <script src="{% static 'race/race_script.js' %}"></script>
</head>

<body>
    <header>
        <img src="{% static 'race/images/UniversityOfExeterLogo.png' %}" alt="Exeter University Logo">
        <a id="pageTitle" href="{% url 'welcome' %}">ExePLORE</a>
    </header>
    <main>
        <div class="title">Races!</div>
        <div id="map">
            <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
            <script>
                 // Create a data object that for external js
                const raceData = {
                    start: {
                        lat: {{ race.start.latitude }},
                        lng: {{ race.start.longitude }},
                        name: "{{ race.start.name }}"
                    },
                    end: {
                        lat: {{ race.end.latitude }},
                        lng: {{ race.end.longitude }},
                        name: "{{ race.end.name }}"
                    }
                };
            </script>
            <script src="{% static 'race/race_map_script.js' %}"></script>
        </div>
        <div class="menu">
            <a href="{% url 'race' %}" id="routePOIs">{{ race.title }} â–º</a>
            <a id="leaderboard" href="{% url 'leaderboard_view'%}?race_title={{ race.title }}">Leaderboards</a>
            <div id="status">
                {% if entry.is_complete%}
                <p>Race status: Completed!</p>
                {% else %}
                <p>You haven't explored this route yet!</p>
                {% endif %}
            </div>
            <div class="time">
                <img src="" alt="">
                {% if entry.is_complete%}
                <p>Personal Best Time: {{entry.get_duration}}</p>
                {% else %}
                <p>Personal Best Time: No time found</p>
                {% endif %}
            </div>
                <div class="actionButtons">
                <button style="background-color: red;" onclick="getLocation()">Where am I?</button>
                <button style="background-color: gold;" onclick="startTimeTrial()">Time Trial</button>
                <button style="background-color: forestgreen;" onclick="startExePLORE()">ExePLORE</button>
            </div>
        </div>
        <div id="activeTimeTrialView">
            <div id="timer">00:00</div>
            <button style="background-color: forestgreen;" onclick="endTimeTrial()">Finish</button>
            <button style="background-color: red;" onclick="document.getElementById('activeTimeTrialView').classList.remove('visible')">Exit</button>
        </div>
        <div id="activeExePLOREView">
            <div id="qoute">"Leave it better than you found it, Be found better than you where"</div>
            <button style="background-color: forestgreen;" onclick="endExePLORE()">Finish</button>
            <button style="background-color: red;" onclick="document.getElementById('activeExePLOREView').classList.remove('visible')">Exit</button>
        </div>
    </main>
    
</body>

